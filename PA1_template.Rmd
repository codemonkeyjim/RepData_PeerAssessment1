---
title: "Reproducible Research: Peer Assessment 1"
author: Jim Pfleger
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

### Retrieve and unzip data file

```{r}
datafile <- 'activity.csv'
if (!file.exists(datafile)) {
  zip <- 'activity.zip'
  if (!file.exists(zip)) {
    download.file('https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip', zip, method = 'libcurl')
  }
  unzip(zip)
}
```

### Tidy data

```{r, cache=TRUE}
library(lubridate)
steps.raw <- read.csv(datafile)
steps.raw$date <- ymd(steps.raw$date)
steps.raw$interval <- factor(steps.raw$interval)
```


## What is mean total number of steps taken per day?

### Summarize by day

```{r}
library(dplyr, quietly = TRUE, warn.conflicts = FALSE)
steps.daily <- steps.raw %>% group_by(date) %>% summarize(steps = sum(steps))
```

### Histogram of daily steps

```{r fig.height=7,fig.width=14}
library(ggplot2)
g <- ggplot(steps.daily, aes(x = steps))
g <- g + geom_histogram(binwidth=500, color = 'black', fill = 'gray')
g <- g + labs(title = 'Count of Daily Steps Totals',
              x = 'Total Daily Steps (ignore NAs)',
              y = '')
g
```

### Summary statistics for daily steps

```{r}
daily.mean <- mean(steps.daily$steps, na.rm = TRUE)
daily.median <- median(steps.daily$steps, na.rm = TRUE)
summary <- rbind(c(daily.mean, daily.median))
rownames(summary) <- c('Daily')
colnames(summary) <- c('Mean', 'Median')
summary
```

## What is the average daily activity pattern?

### Summarize by interval

```{r}
library(dplyr, quietly = TRUE, warn.conflicts = FALSE)
steps.interval <- steps.raw %>% group_by(interval) %>% summarize(steps = mean(steps, na.rm = TRUE))
```

### Line chart of steps by interval

```{r fig.height=7,fig.width=14}
library(ggplot2)
g <- ggplot(steps.interval, aes(x = interval, y = steps, group = NA))
g <- g + geom_line()
g <- g + labs(title = 'Average Steps by Interval',
              x = 'Interval',
              y = 'Average Steps')
g
```

## Impute missing values

Create a new dataset of raw steps but replace any NA values for steps with the mean for that interval.

```{r}
library(dplyr, quietly = TRUE, warn.conflicts = FALSE)
steps.imputed <- merge(steps.raw, steps.interval, by = c('interval'))
steps.imputed[is.na(steps.imputed$steps.x),]$steps.x <- steps.imputed[is.na(steps.imputed$steps.x),]$steps.y
steps.imputed <- select(steps.imputed, interval = interval, steps = steps.x, date = date)
```

### Summarize by day (including imputed)

```{r}
library(dplyr, quietly = TRUE, warn.conflicts = FALSE)
steps.daily.imputed <- steps.imputed %>% group_by(date) %>% summarize(steps = sum(steps))
```

### Histogram of daily steps (including imputed)

```{r fig.height=7,fig.width=14}
library(ggplot2)
g <- ggplot(steps.daily.imputed, aes(x = steps))
g <- g + geom_histogram(binwidth=500, color = 'black', fill = 'gray')
g <- g + labs(title = 'Count of Daily Steps Totals',
              x = 'Total Daily Steps (incl imputed)',
              y = '')
g
```

### Summary statistics for daily steps (including imputed)

```{r}
daily.mean.imputed <- mean(steps.daily.imputed$steps)
daily.median.imputed <- median(steps.daily.imputed$steps)
summary <- rbind(c(daily.mean, daily.median), c(daily.mean.imputed, daily.median.imputed))
rownames(summary) <- c('Daily (raw)', 'Daily (imputed)')
colnames(summary) <- c('Mean', 'Median')
summary
```

The daily mean is unchanged because the NAs were replaced with the interval means. However, the median is slightly larger.

## Are there differences in activity patterns between weekdays and weekends?

### Determine weekdays and weekends

```{r}
library(lubridate)
# Is weekend?
# wday() returns 1 for Sunday and 7 for Saturday. Change to 0 and 6 and modulo by 6.
steps.imputed$daytype <- (wday(steps.imputed$date) - 1) %% 6 == 0 
steps.imputed$daytype <- factor(steps.imputed$daytype, labels = c('weekday', 'weekend'))
```

